@model IEnumerable<VeggieRestaurantApp.Models.Diner>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div>
    <h1 class="display-3">Welcome Plant Based Foodies</h1>
    <p class="lead">
        We simplify the search for plant based dining in your local area. We provide information on restaurants that cater to plant based diners.<br>
        No more boring side salads and veggie burgers for you!
    </p>
</div>
<div>
    <h1> Dining In? </h1>
</div>
<div>
    <div class="form-group">
        <label class="col-form-label col-form-label-lg" for="inputLarge">Search for a recipe!</label>
        <input class="form-control form-control-lg" type="text" placeholder="Search Recipe" id="inputLarge">
        <button type="Submit" class="btn btn-primary" id="Search">Search</button>
    </div>
</div>
<table id="recipeTable" class="table table-hover">
    <thead>
        <tr id="recipeTable" class="table-success">
            <th scope="row">Recipe Name</th>
            <th scope="row">Recipe URL</th>
            <th scope="row">Health Labels</th>
            <th scope="row">Recipe Image</th>
        </tr>
    </thead>
    <tbody>
        <tr class="table-active"></tr>
        <tr scope="row"> </tr>
    </tbody>
</table>
<div> <h1>Dining Out?</h1></div>
<div class="row">
    <div class="col-md-12">
        <div id="map" style="height:400px; width: 400px;">

            <script>
                let map, infoWindow;
                function initMap() {
                    map = new google.maps.Map(document.getElementById("map"), {
                        center: { lat: 43.0579, lng: -87.8991 },
                        zoom: 15,
                    });
                    infoWindow = new google.maps.InfoWindow();
                    const locationButton = document.createElement("button");
                    locationButton.textContent = "Pan to Current Location";
                    locationButton.classList.add("custom-map-control-button");
                    map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
                    locationButton.addEventListener("click", () => {
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(
                                (position) => {
                                    const pos = {
                                        lat: position.coords.latitude,
                                        lng: position.coords.longitude,
                                    };
                                    infoWindow.setPosition(pos);
                                    infoWindow.setContent("You Are Here");
                                    infoWindow.open(map);
                                    map.setCenter(pos);
                                },
                                () => {
                                    handleLocationError(true, infoWindow, map.getCenter());
                                }
                            );
                        } else {
                            // Browser doesn't support Geolocation
                            handleLocationError(false, infoWindow, map.getCenter());
                        }
                    });
                }
                function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                    infoWindow.setPosition(pos);
                    infoWindow.setContent(
                        browserHasGeolocation
                            ? "Error: The Geolocation service failed."
                            : "Error: Your browser doesn't support geolocation."
                    );
                    infoWindow.open(map);
                }


            </script>
            <script defer
                    src="https://maps.googleapis.com/maps/api/js?key=@ViewData["GOOGLE_API_KEY"]&libraries=places&callback=initMap">
            </script>

        </div>
    </div>
    <div class="col-md-12">
        <h6>Search Out Network of Restaurants</h6>
    </div>
</div>
    <script>
        let searchButton = document.getElementById('Search');
        searchButton.addEventListener("click", () => {
            sendApiRequest()
        })

        async function sendApiRequest() {
            let APP_ID = "27dc2445"
            let API_KEY = "eef31258535ef241d8d42137edaceddf"
            var input = document.getElementById("inputLarge")
            const response = await fetch(`https://api.edamam.com/search?app_id=${APP_ID}&app_key=${API_KEY}&q=${input.value}&from=0&to=5&health=vegetarian`)
            console.log(response)
            let data = await response.json()
            console.log(data)
            useApiData(data)
        }

        function useApiData(data) {
            let content = document.getElementById("content");
            console.log(data);
            $("#recipeTable").append(
                `<tr>
                            <td>${data.hits[0].recipe.label}</td>
                            <td><a href = ${data.hits[0].recipe.url}>${data.hits[0].recipe.url}</a></td>
                            <td>${data.hits[0].recipe.healthLabels}</td>
                            <td> <img src= ${data.hits[0].recipe.image} alt=" recipe image" width: "auto" height= "100 px"></td>
                </tr>`

            )
        };
    </script>


